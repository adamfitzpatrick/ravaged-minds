<div class="content-page story-detail" md-theme="content_page">

    <md-toolbar
        class="content-page__toolbar story-detail__header"
        md-whiteframe="4"
        layout="row"
    >
        <div
            class="content-page__title"
            flex
            layout="column"
            layout-align="center space-between"
        >
            Chapter {{ vm.story.id }}
            <h1 class="content-page__title--leader">{{ vm.story.title }}</h1>
        </div>
        <div>
            <span ng-if="!vm.savingStatus">
                <md-button
                    ng-if="vm.hasStatus('success')"
                    class="md-fab"
                    ng-click="vm.saveStatus()"
                >
                    <md-icon class="material-icons">check</md-icon>
                </md-button>
                <md-button
                    ng-if="vm.hasStatus('failure')"
                    class="md-fab md-warn"
                    ng-click="vm.saveStatus()"
                >
                    <md-icon class="material-icons">close</md-icon>
                </md-button>
                <md-button
                    ng-if="vm.hasStatus('incomplete')"
                    class="md-fab md-primary"
                    ng-click="vm.saveStatus()"
                >
                    <md-icon class="material-icons">security</md-icon>
                </md-button>
            </span>
            <md-progress-circular
                ng-if="vm.savingStatus"
                class="md-accent md-hue-3 story-detail__progress"
                md-mode="indeterminate"
                md-diameter="56"
            ></md-progress-circular>
        </div>
    </md-toolbar>

    <div
        layout="row"
    >
        <md-content
            class="content-page__content"
            flex="66"
        >
            <div ng-bind-html="vm.storyContent"></div>
        </md-content>
        <md-content
            class="content-page__content story-detail__data"
            flex="33"
        >
            <h3 class="story-detail__map-header">Maps</h3>
            <md-list>
                <md-list-item
                    ng-click="vm.showMap(map)"
                    class="md-2-line"
                    ng-repeat="map in vm.maps"
                >
                    <div class="md-list-item-text">
                        <h3>{{ map.name }}</h3>
                    </div>
                </md-list-item>
            </md-list>

            <h3>Entities</h3>
            <md-list>
                <md-list-item
                    class="md-2-line"
                    ng-repeat="entity in vm.entities"
                    ng-click="vm.showEntity(entity)"
                >
                    <img class="md-avatar" ng-src="{{ entity.imageUrl }}"/>
                    <div class="md-list-item-text">
                        <h3>{{ entity.name }}</h3>
                        <p>{{ entity.shortDescriptor }}</p>
                    </div>
                </md-list-item>
            </md-list>
        </md-content>
    </div>
</div>
